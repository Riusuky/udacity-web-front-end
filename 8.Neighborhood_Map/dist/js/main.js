!function(){"use strict";$(function(){function e(){var e=l;l.map=new google.maps.Map($(".map-container")[0],{center:s,zoom:15,styles:window.mapStyle,mapTypeControl:!1,streetViewControl:!1}),l.createMarker=function(t){t.marker||(t.marker=new google.maps.Marker({position:t.location,title:t.name,animation:google.maps.Animation.DROP,label:{fontFamily:"FontAwesome",fontSize:"0.9em",color:"white",text:t.type.character},icon:{url:"img/normal-marker.png",labelOrigin:new google.maps.Point(11,13)}}),requestAnimationFrame(function(){t.marker.setMap(e.map)})),t.foursquareID&&!t.foursquareData&&(t.infoWindow=new google.maps.InfoWindow({content:"Loading content from Foursquare..."}),t.marker.addListener("click",function(){e.markerClickedCallback&&e.markerClickedCallback(t)}),r.retrieveSpotByID(t.foursquareID,function(e){var i=e.name,n=null;if(e.photos&&e.photos.count>0){var o=e.photos.groups[0].items[0].width,a=e.photos.groups[0].items[0].height;o/a>1.3?o=Math.floor(1.3*a):a=Math.floor(o/1.3),n=e.photos.groups[0].items[0].prefix+o+"x"+a+e.photos.groups[0].items[0].suffix}var s=e.hereNow.count,r=e.rating,l=e.description;t.createInfoContent(i,n,s,r,l),t.infoWindow.setContent(t.infoContent)},function(){t.createInfoContent("Could not load data from Foursquare =("),t.infoWindow.setContent(t.infoContent)}))},l.removeSpot=function(e){e.marker&&e.marker.setMap(null),e.infoWindow&&e.infoWindow.close()},l.updateMarkerVisibility=function(e){e&&e.marker&&(e.type.visible()?requestAnimationFrame(function(){e.marker.setVisible(!0),e.marker.setAnimation(google.maps.Animation.DROP)}):(l.setInfoWindowVisibility(e,!1),requestAnimationFrame(function(){e.marker.setVisible(!1)})))},l.setInfoWindowVisibility=function(t,i){t.infoWindow&&requestAnimationFrame(function(){i?t.infoWindow.open(e.map,t.marker):t.infoWindow.close(),t.infoWindowVisible=i})},l.panTo=function(t){requestAnimationFrame(function(){e.map.panTo(t)})},l.extendBounds=function(t){requestAnimationFrame(function(){var i=new google.maps.LatLngBounds;t.length>0&&(t.forEach(function(e){i.extend(e.location)}),e.map.fitBounds(i))})},l.setSpotHighlight=function(e,t){requestAnimationFrame(function(){if(e.marker){var i=e.marker.getIcon(),n=e.marker.getLabel();i.url=t?"img/selected-marker.png":"img/normal-marker.png",n.color=t?"#f36548":"white",e.marker.setIcon(i),e.marker.setLabel(n)}})}}var t='<article class="spot-info"><header><h3>%title%</h3></header><img  class="spot-image rounded-border" src="%img-src%" alt="%img-alt%"><p><span class="spot-current-people"><span class="label">People there now:</span> <span class="value">%people%</span></span><span class="spot-rating"><span class="label">Rating:</span> <span class="value">%rating%</span></span></p><p class="spot-description">%description%</p><footer class="spot-footer"><p><em>Powered by <span class="red-text">Foursquare</span> <span class="red-text fa fa-foursquare"></span></em></p></footer></article>',i=function(e,t){this.lat=e,this.lng=t},n=function(e,t,i){this.name=e,this.className=t,this.visible=ko.observable(!0),this.character=i},o=[new n("University","fa-graduation-cap",""),new n("Movie Theater","fa-film",""),new n("Shopping Mall","fa-credit-card",""),new n("Theater","fa-university",""),new n("Restaurant","fa-glass",""),new n("Favorite","fa-star","")],a=function(e,t,i,n){this.name=e,this.location=t,this.type=o[i],this.foursquareID=n,this.originalArgments={name:e,location:t,typeID:i,foursquareID:n}};a.prototype.createInfoContent=function(e,i,n,o,a){this.infoContent=t.replace(/%title%/g,e).replace(/%img-src%/g,i||"").replace(/%img-alt%/g,i?e+" photo":"").replace(/%people%/g,n||"0").replace(/%rating%/g,o||"Unavailable").replace(/%description%/g,a||"")};var s={lat:-22.009815,lng:-47.890911},r={};!function(){function e(e){return n+e+"?"+l+"&"+c}function t(e,t){return o+"?ll="+e.lat+","+e.lng+"&radius=6000&limit=1&intent=browse&query="+t+"&"+l+"&"+c}function i(e,t){return a+"?ll="+e.lat+","+e.lng+"&radius=6000&limit=15&query="+t+"&"+l+"&"+c}var n="https://api.foursquare.com/v2/venues/",o="https://api.foursquare.com/v2/venues/search",a="https://api.foursquare.com/v2/venues/suggestcompletion",l="client_id=KA305KK30MBVHBCVTPQQNHFC55AUXIHWBH0PICUPA5PCYZ3Z&client_secret=TGBKJCYOLDAZCNSU5VCTWVKHXMEYNNH0RGAJGZ4NYXMW5EE5",c=function(){var e=new Date,t=e.getFullYear().toString(),i=(e.getMonth()+1).toString();i=i.length>1?i:"0"+i;var n=e.getDate().toString();return n=n.length>1?n:"0"+n,"v="+t+i+n}();r.retrieveSpotByID=function(t,i,n){$.getJSON(e(t),function(e){i&&e.response&&e.response.venue?i(e.response.venue):n&&n()}).fail(n)},r.searchForSpot=function(e,i,n){$.getJSON(t(s,e),function(e){i&&e.response&&e.response.venues&&e.response.venues.length>0?i(e.response.venues[0]):n&&n()}).fail(n)},r.getAutocomplete=function(e,t,n){$.getJSON(i(s,e),function(e){if(t&&e.response&&e.response.minivenues&&e.response.minivenues.length>0){var i=[];e.response.minivenues.forEach(function(e){i.push(e.name)}),t(i)}else n&&n()}).fail(n)}}();var l={},c=[new a("UFSCar",new i(-21.9858147,-47.8800048),0,"4c49a8966594be9a3e126025"),new a("USP 1",new i(-22.0086098,-47.8974033),0,"4bfc201fd6f2c9b693c14ec8"),new a("USP 2",new i(-22.002026337513556,-47.930731773376465),0,"4d946b35cf46224b588f9394"),new a("Unicep",new i(-22.0319650340178,-47.87670135498047),0,"4dc990efd4c0abe9b63302ca"),new a("Cine Araújo",new i(-22.0144537,-47.9054762),1,"4d813b511013236ab4699735"),new a("Cine São Carlos",new i(-22.01694347915993,-47.8892290962072),1,"4cb12f12562d224baf2d1d88"),new a("Passeio São Carlos",new i(-22.005330502395463,-47.904135024674616),2,"567467c7498eff76ae3e2984"),new a("Shopping Iguatemi",new i(-22.01746395704613,-47.91506767272949),2,"4b82b047f964a52097de30e3"),new a("Town's Theater",new i(-22.01597199247966,-47.893524169921875),3,"4c8c1118ed3ab60cb1646421"),new a("Amici",new i(-22.012120549472062,-47.897939408804774),4,"4d23b1e0fdfb236ab8d17267"),new a("Yachi",new i(-22.014168330969095,-47.882219389138136),4,"52e97b6211d2245118a33991"),new a("Chez Marcel",new i(-21.995779002666776,-47.890059508178936),4,"4bb3be4b35f0c9b61bd2bc83")],u=function(){function e(e,t,i){clearInterval(u);var n=0;u=setInterval(function(){t(e[n]),++n>=e.length&&clearInterval(u)},i)}var t=this,n=!1,s=!1;this.favList=ko.observableArray(),(localStorage.favoriteSpots?JSON.parse(localStorage.favoriteSpots):[]).forEach(function(e){t.favList.push(new a(e.name,e.location,e.typeID,e.foursquareID))}),this.spotList=ko.observableArray(c.concat(t.favList())),this.spotTypes=ko.observableArray(o),this.searchAvailable=ko.observable(!0),this.favoriteSearchValue=ko.observable(""),this.favoriteSearchAutocomplete=ko.observableArray(),this.sideMenuIsVisible=ko.observable(!1),this.filterListIsVisible=ko.observable(!1),this.favoriteTabSelected=ko.observable(!1),this.spotTabSelected=ko.pureComputed(function(){return!t.favoriteTabSelected()}),this.selectedSpot=null,this.animationInterval=200;var u=null;this.updateMarkersVisibility=function(i){e(t.spotList().filter(function(e){return e.type===i}),l.updateMarkerVisibility,i.visible()?t.animationInterval:0)},this.setSideMenuVisibility=function(e){t.sideMenuIsVisible()!=e&&(t.sideMenuIsVisible(e),e&&t.centerMap())},this.selectSpotTab=function(){t.sideMenuIsVisible()?t.favoriteTabSelected()||t.setSideMenuVisibility(!1):t.setSideMenuVisibility(!0),t.favoriteTabSelected(!1)},this.selectFavoriteTab=function(){t.sideMenuIsVisible()?t.favoriteTabSelected()&&t.setSideMenuVisibility(!1):t.setSideMenuVisibility(!0),t.favoriteTabSelected(!0)},this.showFilterList=function(){t.filterListIsVisible(!0)},this.hideFilterList=function(){t.filterListIsVisible(!1)},this.onFilterListClick=function(){n=!0,t.showFilterList()},this.onSideMenuClick=function(){return s=!0,!0},this.onAppClick=function(){return n||t.hideFilterList(),n=!1,s||t.setSideMenuVisibility(!1),s=!1,!0},this.centerMap=function(){l.extendBounds(t.spotList().filter(function(e){return e.type.visible()}))},this.panToSpot=function(e){l.panTo(e.location)},this.hideAllInfoWindow=function(){t.spotList().forEach(function(e){e.infoWindowVisible&&l.setInfoWindowVisibility(e,!1)})},this.setMapInitializedCallback=function(e){e&&requestAnimationFrame(function(){l&&l.map&&l.map.getBounds()?e():t.setMapInitializedCallback(e)})},this.selectSpot=function(e){if(e.type.visible())if(t.selectedSpot==e)l.setInfoWindowVisibility(e,!e.infoWindowVisible);else{if(t.selectedSpot){var i=t.selectedSpot;l.setSpotHighlight(i,!1)}l.setSpotHighlight(e,!0),t.hideAllInfoWindow(),l.setInfoWindowVisibility(e,!0),t.selectedSpot=e}},this.updateFavoriteLocalStorage=function(){var e=[];t.favList().forEach(function(t){e.push(t.originalArgments)}),localStorage.favoriteSpots=JSON.stringify(e)},this.addFavoriteSpot=function(e){t.favList().concat(t.spotList()).some(function(t){return t.foursquareID==e.foursquareID})||(t.favList.push(e),t.spotList.push(e),l.createMarker(e),t.updateFavoriteLocalStorage(),t.selectSpot(e))},this.removeFavoriteSpot=function(e){t.favList.remove(e),t.spotList.remove(e),l.removeSpot(e),t.updateFavoriteLocalStorage()},this.searchAndAddFavoriteSpot=function(){return t.favoriteSearchValue()&&(t.searchAvailable(!1),r.searchForSpot(t.favoriteSearchValue(),function(e){var n=new a(e.name,new i(e.location.lat,e.location.lng),5,e.id);t.addFavoriteSpot(n),t.searchAvailable(!0)},function(){window.alert("It was not possible to find a spot for the given search: "+t.favoriteSearchValue()),t.searchAvailable(!0)}),t.favoriteSearchValue("")),!0},this.initMap=function(){l.markerClickedCallback=t.selectSpot;var i=t.spotList();t.centerMap(),e(i,l.createMarker,t.animationInterval)},this.favoriteSearchValue.subscribe(function(e){var i=e.trim();i&&(t.favoriteSearchAutocomplete().some(function(e){return e==i})||r.getAutocomplete(i,function(e){t.favoriteSearchAutocomplete(e)},function(){console.log("Could not retrieve autocomplete data.")}))}),this.spotTypes().forEach(function(e){e.visible.subscribe(function(){t.updateMarkersVisibility(e)})}),this.setMapInitializedCallback(this.initMap)};window.googleMapInitialized?e():window.googleMapCallback=e,ko.applyBindings(new u)})}();